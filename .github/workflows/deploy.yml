name: Deploy to Server

on:
    push:
        branches:
            - main
jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout (optional, f√ºr lokale Nutzung)
              uses: actions/checkout@v4

            - name: Add SSH key
              uses: webfactory/ssh-agent@v0.9.0
              with:
                  ssh-private-key: ${{ secrets.SSH_KEY }}

            - name: Deploy over SSH
              run: |
                  ssh -o StrictHostKeyChecking=no -p "${{ secrets.SSH_PORT }}" \
                  "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}" << 'EOF'
                  cd /opt/git/uranus-dashboard/

                  git fetch origin
                  git reset --hard origin/main

                  # WICHTIG: ohne --omit=dev
                  npm ci

                  npm run build
                  EOF
